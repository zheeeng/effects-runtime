name: GE AI Bot

on:
  issues:
    types: [opened, labeled]
  issue_comment:
    types: [created]
  pull_request:
    types: [opened, synchronize, labeled]

jobs:
  bot:
    runs-on: ubuntu-latest
    steps:
      # 1. 首先检出当前仓库代码
      - name: Checkout Current Repo
        uses: actions/checkout@v4

      # 2. 然后检出 Action 源码到指定子目录
      - name: Checkout Action
        uses: actions/checkout@v4
        with:
          repository: zheeeng/GalaceanEffectsAIDeveloper # 您的 Action 仓库
          ref: release                                   # ⚠️ 必须指定 release 分支 (包含构建产物)
          token: ${{ secrets.PRIVATE_ACTION_TOKEN }}     # 必须是 PAT
          path: .github/actions/ge-bot

      # 3. 安装 Claude Code CLI
      - name: Install Claude Code CLI
        run: npm install -g @anthropic-ai/claude-code
        # 如果使用 Mock AI (ai-mock: 'true')，可以跳过此步骤

      # 4. 使用本地路径引用 Action
      - name: Run GE AI Bot
        uses: ./.github/actions/ge-bot
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          ANTHROPIC_MODEL: 'opus'  # 可选，默认为 opus
          ANTHROPIC_TIMEOUT: '1800'  # 可选，默认 30 分钟
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          ai-mock: 'false' # 设置为 true 开启模拟模式（不使用 Claude Code）
